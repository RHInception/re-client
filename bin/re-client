#!/usr/bin/env python
import readline
from reclient import ReClient
import os

conf_file = os.path.expanduser('~/.rerest.conf')

def cmds():
    print """
1) Get a all playbooks for a project
2) Get a single playbook for a project
3) Update a playbook
4) Delete a playbook
5) Create a new playbook"""

def repl():
    with open(conf_file, 'r') as config:
        baseurl = config.read()

    reclient = ReClient(baseurl)
    while True:
        cmds()
        action = int(raw_input("command>> "))

        if action == 1:
            project = raw_input("Project: ")
            reclient.get_all_playbooks(project)
        elif action == 2:
            project = raw_input("Project: ")
            pb_id = raw_input("Playbook ID: ")
            reclient.view_file(project, pb_id)
        elif action == 3:
            project = raw_input("Project: ")
            pb_id = raw_input("Playbook ID: ")
            reclient.edit_playbook(project, pb_id)


if __name__ == '__main__':
    if not os.path.exists(conf_file):
        print "Could not load base rerest url from %s" % conf_file
        print "Enter the base url (http://.......:PORT) for your rerest endpoint"
        print "This will be saved in %s for reuse later" % conf_file
        baseurl = raw_input("Base Url: ")

        with open(conf_file, 'w') as _config:
            _config.write(baseurl)

    repl()
