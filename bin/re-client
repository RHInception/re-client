#!/usr/bin/env python
import urllib2
import os
try:
    import json
except ImportError:
    import simplejson as json
import base64
import readline

"""
Handles basic HTTP authentication to the rerest endpoint.
"""

class ReClient(object):
    def __init__(self):
        self.conf_file = os.path.expanduser('~/.rerest.conf')
        self._config()

    def _config(self):
        """Get the endpoint configuration"""
        username = "foo"
        password = "bar"
        self.auth_header = base64.encodestring('%s:%s' % (username, password))[:-1]
        with open(self.conf_file, 'r') as config:
            self.baseurl = config.read()
        self.endpoint = "%s/api/v0/" % self.baseurl

    def run(self):
        """
        Make an API call to get the requested item. Store the results.
        """
        req = urllib2.Request(self.endpoint + "example%20project/playbook/")
        req.add_header("Authorization", "Basic %s" % self.auth_header)
        response = urllib2.urlopen(req)
        print response.read()


conf_file = os.path.expanduser('~/.rerest.conf')
if not os.path.exists(conf_file):
    print "Could not load base rerest url from %s" % conf_file
    print "Enter the base url (http://.......:PORT) for your rerest endpoint"
    print "This will be saved in %s for reuse later" % conf_file
    baseurl = raw_input("Base Url: ")

    with open(conf_file, 'w') as _config:
        _config.write(baseurl)

r = ReClient()
r.run()
